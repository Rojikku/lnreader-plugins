var e=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(o,r){function i(e){try{s(n.next(e))}catch(e){r(e)}}function l(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,l)}s((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var a,n,o,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=l(0),i.throw=l(1),i.return=l(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(s){return function(l){if(a)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(r=0)),r;)try{if(a=1,n&&(o=2&l[0]?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==l[0]&&2!==l[0])){r=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(6===l[0]&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(e){l=[6,e],n=0}finally{a=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("cheerio"),n=require("@libs/fetch"),o=require("@libs/novelStatus"),r=new(function(){function r(e){var t;this.id=e.id,this.name=e.sourceName,this.icon="multisrc/readnovelfull/".concat(e.id.toLowerCase(),"/icon.png"),this.site=e.sourceSite;var a=(null===(t=e.options)||void 0===t?void 0:t.versionIncrements)||0;this.version="2.0.".concat(1+a),this.options=e.options,this.filters=e.filters}return r.prototype.getCheerio=function(o,r){return e(this,void 0,void 0,(function(){var e,i;return t(this,(function(t){switch(t.label){case 0:return[4,(0,n.fetchApi)(o)];case 1:if(!(e=t.sent()).ok&&1!=r)throw new Error("Could not reach site ("+e.status+") try to open in webview.");return i=a.load,[4,e.text()];case 2:return[2,i.apply(void 0,[t.sent()])]}}))}))},r.prototype.parseNovels=function(e){var t=this.site;return e(".archive .list-novel .row, .archive .list-truyen .row").toArray().map((function(a){var n,o,r,i=e(a),l=null===(n=i.find("h3").text())||void 0===n?void 0:n.trim(),s=i.find("a").attr("href"),c=null!==(r=null!==(o=i.find("img").attr("src"))&&void 0!==o?o:i.find("img").attr("data-cfsrc"))&&void 0!==r?r:i.find("img").attr("data-src");if(!l||!s)return null;var u,h=new URL(s,t).pathname.slice(1);return c&&(u=new URL(c,t).href),{name:l,path:h,cover:u}})).filter(Boolean)},r.prototype.popularNovels=function(a,n){return e(this,arguments,void 0,(function(e,a){var n,o,r,i,l,s,c,u,h=a.filters,p=a.showLatestNovels;return t(this,(function(t){switch(t.label){case 0:return n="",o=this.options.pageParam||"page",this.options.novelListing?(s=new URLSearchParams,r=this.options.typeParam||"type",p?s.append(r,this.options.latestPage):h.genres.value.length?(s.append(r,this.options.genreParam||"category_novel"),i=this.options.genreKey||"id",s.append(i,h.genres.value)):s.append(r,h.type.value),this.options.langParam&&this.options.urlLangCode&&s.append(this.options.langParam,this.options.urlLangCode),s.append(o,e.toString()),n="".concat(this.site).concat(this.options.novelListing,"?").concat(s.toString())):(l="",s=new URLSearchParams(((u={})[o]=e.toString(),u)),l=p?this.options.latestPage:h.genres.value.length?h.genres.value:h.type.value,n="".concat(this.site).concat(l,"?").concat(s.toString())),[4,this.getCheerio(n,!1)];case 1:return c=t.sent(),[2,this.parseNovels(c)]}}))}))},r.prototype.parseNovel=function(a){return e(this,void 0,void 0,(function(){var e,n,r,i,l,s,c,u,h,p,v,d,f,g,m,b,y,w,P,L=this;return t(this,(function(t){switch(t.label){case 0:return[4,this.getCheerio(this.site+a,!1)];case 1:return e=t.sent(),n=this.site,(r={path:a}).name=e("h3.title").first().text().trim(),(i=null!==(P=null!==(w=null!==(y=null!==(b=e(".book img").attr("src"))&&void 0!==b?b:e(".book img").attr("data-cfsrc"))&&void 0!==y?y:e(".book img").attr("data-src"))&&void 0!==w?w:e(".book noscript img").attr("src"))&&void 0!==P?P:e('meta[name="image"]').attr("content"))&&(r.cover=new URL(i,n).href),e("ul.info.info-meta li, .info div").each((function(){var t,a,n=e(this).text().split(":"),i=n[0].trim().toLowerCase(),l=null===(t=n[1])||void 0===t?void 0:t.split(",").map((function(e){return e.trim()})).join(", ");switch(i){case"author":r.author=l;break;case"genre":r.genres=l;break;case"status":var s={completed:o.NovelStatus.Completed,ongoing:o.NovelStatus.Ongoing,hiatus:o.NovelStatus.OnHiatus};r.status=null!==(a=s[l.toLowerCase()])&&void 0!==a?a:o.NovelStatus.Unknown}})),l=e(".desc-text"),s=l.find("p"),r.summary=s.length>0?s.map((function(t,a){return e(a).text().trim()})).get().join("\n\n"):l.text().trim(),c=[],u=e("#rating").attr("data-novel-id"),h=a.match(/\d+/),(p=u||(h?h[0]:null))?(v=this.options.chapterListing||"ajax/chapter-archive",d=this.options.chapterParam||"novelId",f=new URLSearchParams(((m={})[d]=p.toString(),m)),g="".concat(this.site).concat(v,"?").concat(f.toString()),[4,this.getCheerio(g,!1)]):[3,3];case 2:e=t.sent(),e(".panel-body li a, select option").each((function(t,a){var n=e(a),o=n.attr("title")||n.text()||"",r=n.attr("href")||n.attr("value")||"",i=new URL(r,L.site).pathname.slice(1);c.push({name:o,path:i,releaseTime:null})})),t.label=3;case 3:return r.chapters=c,[2,r]}}))}))},r.prototype.parseChapter=function(a){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,this.getCheerio(this.site+a,!1)];case 1:return(e=t.sent())("div.ads, div.unlock-buttons").remove(),[2,e("#chr-content, #chapter-content").html()||""]}}))}))},r.prototype.searchNovels=function(a,n){return e(this,void 0,void 0,(function(){var e,o,r,i,l;return t(this,(function(t){switch(t.label){case 0:return e=this.options.pageParam||"page",o=new URLSearchParams(((l={keyword:a})[e]=n.toString(),l)),this.options.langParam&&o.append(this.options.langParam,this.options.urlLangCode),r="".concat(this.site).concat(this.options.searchPage,"?").concat(o.toString()),[4,this.getCheerio(r,!0)];case 1:return i=t.sent(),[2,this.parseNovels(i)]}}))}))},r}())({id:"lightnovelplus",sourceSite:"https://lightnovelplus.com/",sourceName:"LightNovelPlus",options:{novelListing:"book/bookclass.html",searchPage:"book/search.html",chapterListing:"get_chapter_list",chapterParam:"bookId",latestPage:"last_release",pageParam:"page_num",langParam:"language",urlLangCode:"en"},filters:{type:{type:"Picker",label:"Novel Listing",value:"hot_novel",options:[{label:"Hot Novel",value:"hot_novel"},{label:"Novel Completed",value:"completed_novel"}]},genres:{type:"Picker",label:"Genre",value:"",options:[{label:"Fantasy",value:"60"},{label:"Action",value:"132"},{label:"Sci-fi",value:"61"},{label:"Romance",value:"59"},{label:"Adventure",value:"62"},{label:"Xuanhuan",value:"64"},{label:"Modern",value:"66"},{label:"Mystery",value:"63"},{label:"Romance",value:"68"},{label:"Fantasy",value:"70"},{label:"Historical",value:"74"},{label:"Sci-fi",value:"75"},{label:"Xuanhuan",value:"76"},{label:"Mystery",value:"77"},{label:"Adventure",value:"116"},{label:"LGBT+",value:"182"},{label:"Fantasy Romance",value:"134"},{label:"Video Games",value:"243"},{label:"Sci-fi Romance",value:"252"},{label:"Historical Romance",value:"256"},{label:"Magical Realism",value:"331"},{label:"Eastern Fantasy",value:"334"},{label:"Contemporary Romance",value:"344"},{label:"Games",value:"503"},{label:"Urban",value:"504"},{label:"Harem",value:"517"}]}}});exports.default=r;