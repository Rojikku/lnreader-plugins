var e=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(a,l){function r(e){try{s(o.next(e))}catch(e){l(e)}}function i(e){try{s(o.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}s((o=o.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var n,o,a,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},r=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return r.next=i(0),r.throw=i(1),r.return=i(2),"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,i[0]&&(l=0)),l;)try{if(n=1,o&&(a=2&i[0]?o.return:i[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(!(a=l.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1],a=i;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(i);break}a[2]&&l.ops.pop(),l.trys.pop();continue}i=t.call(e,l)}catch(e){i=[6,e],o=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var n=require("cheerio"),o=require("@libs/fetch"),a=require("@libs/novelStatus"),l=new(function(){function l(e){var t;this.id=e.id,this.name=e.sourceName,this.icon="multisrc/readnovelfull/".concat(e.id.toLowerCase(),"/icon.png"),this.site=e.sourceSite;var n=(null===(t=e.options)||void 0===t?void 0:t.versionIncrements)||0;this.version="2.0.".concat(1+n),this.options=e.options,this.filters=e.filters}return l.prototype.getCheerio=function(a,l){return e(this,void 0,void 0,(function(){var e,r;return t(this,(function(t){switch(t.label){case 0:return[4,(0,o.fetchApi)(a)];case 1:if(!(e=t.sent()).ok&&1!=l)throw new Error("Could not reach site ("+e.status+") try to open in webview.");return r=n.load,[4,e.text()];case 2:return[2,r.apply(void 0,[t.sent()])]}}))}))},l.prototype.parseNovels=function(e){var t=this.site;return e(".archive .list-novel .row, .archive .list-truyen .row").toArray().map((function(n){var o,a,l,r=e(n),i=null===(o=r.find("h3").text())||void 0===o?void 0:o.trim(),s=r.find("a").attr("href"),v=null!==(l=null!==(a=r.find("img").attr("src"))&&void 0!==a?a:r.find("img").attr("data-cfsrc"))&&void 0!==l?l:r.find("img").attr("data-src");if(!i||!s)return null;var u,c=new URL(s,t).pathname.slice(1);return v&&(u=new URL(v,t).href),{name:i,path:c,cover:u}})).filter(Boolean)},l.prototype.popularNovels=function(n,o){return e(this,arguments,void 0,(function(e,n){var o,a,l,r,i,s,v,u,c=n.filters,h=n.showLatestNovels;return t(this,(function(t){switch(t.label){case 0:return o="",a=this.options.pageParam||"page",this.options.novelListing?(s=new URLSearchParams,l=this.options.typeParam||"type",h?s.append(l,this.options.latestPage):c.genres.value.length?(s.append(l,this.options.genreParam||"category_novel"),r=this.options.genreKey||"id",s.append(r,c.genres.value)):s.append(l,c.type.value),this.options.langParam&&this.options.urlLangCode&&s.append(this.options.langParam,this.options.urlLangCode),s.append(a,e.toString()),o="".concat(this.site).concat(this.options.novelListing,"?").concat(s.toString())):(i="",s=new URLSearchParams(((u={})[a]=e.toString(),u)),i=h?this.options.latestPage:c.genres.value.length?c.genres.value:c.type.value,o="".concat(this.site).concat(i,"?").concat(s.toString())),[4,this.getCheerio(o,!1)];case 1:return v=t.sent(),[2,this.parseNovels(v)]}}))}))},l.prototype.parseNovel=function(n){return e(this,void 0,void 0,(function(){var e,o,l,r,i,s,v,u,c,h,g,p,b,f,m,d,y,w,S,x=this;return t(this,(function(t){switch(t.label){case 0:return[4,this.getCheerio(this.site+n,!1)];case 1:return e=t.sent(),o=this.site,(l={path:n}).name=e("h3.title").first().text().trim(),(r=null!==(S=null!==(w=null!==(y=null!==(d=e(".book img").attr("src"))&&void 0!==d?d:e(".book img").attr("data-cfsrc"))&&void 0!==y?y:e(".book img").attr("data-src"))&&void 0!==w?w:e(".book noscript img").attr("src"))&&void 0!==S?S:e('meta[name="image"]').attr("content"))&&(l.cover=new URL(r,o).href),e("ul.info.info-meta li, .info div").each((function(){var t,n,o=e(this).text().split(":"),r=o[0].trim().toLowerCase(),i=null===(t=o[1])||void 0===t?void 0:t.split(",").map((function(e){return e.trim()})).join(", ");switch(r){case"author":l.author=i;break;case"genre":l.genres=i;break;case"status":var s={completed:a.NovelStatus.Completed,ongoing:a.NovelStatus.Ongoing,hiatus:a.NovelStatus.OnHiatus};l.status=null!==(n=s[i.toLowerCase()])&&void 0!==n?n:a.NovelStatus.Unknown}})),i=e(".desc-text"),s=i.find("p"),l.summary=s.length>0?s.map((function(t,n){return e(n).text().trim()})).get().join("\n\n"):i.text().trim(),v=[],u=e("#rating").attr("data-novel-id"),c=n.match(/\d+/),(h=u||(c?c[0]:null))?(g=this.options.chapterListing||"ajax/chapter-archive",p=this.options.chapterParam||"novelId",b=new URLSearchParams(((m={})[p]=h.toString(),m)),f="".concat(this.site).concat(g,"?").concat(b.toString()),[4,this.getCheerio(f,!1)]):[3,3];case 2:e=t.sent(),e(".panel-body li a, select option").each((function(t,n){var o=e(n),a=o.attr("title")||o.text()||"",l=o.attr("href")||o.attr("value")||"",r=new URL(l,x.site).pathname.slice(1);v.push({name:a,path:r,releaseTime:null})})),t.label=3;case 3:return l.chapters=v,[2,l]}}))}))},l.prototype.parseChapter=function(n){return e(this,void 0,void 0,(function(){var e;return t(this,(function(t){switch(t.label){case 0:return[4,this.getCheerio(this.site+n,!1)];case 1:return(e=t.sent())("div.ads, div.unlock-buttons").remove(),[2,e("#chr-content, #chapter-content").html()||""]}}))}))},l.prototype.searchNovels=function(n,o){return e(this,void 0,void 0,(function(){var e,a,l,r,i;return t(this,(function(t){switch(t.label){case 0:return e=this.options.pageParam||"page",a=new URLSearchParams(((i={keyword:n})[e]=o.toString(),i)),this.options.langParam&&a.append(this.options.langParam,this.options.urlLangCode),l="".concat(this.site).concat(this.options.searchPage,"?").concat(a.toString()),[4,this.getCheerio(l,!0)];case 1:return r=t.sent(),[2,this.parseNovels(r)]}}))}))},l}())({id:"boxnovel",sourceSite:"https://novlove.com/",sourceName:"BoxNovel",options:{latestPage:"sort/nov-love-daily-update",searchPage:"search"},filters:{type:{type:"Picker",label:"Novel Listing",value:"sort/nov-love-popular",options:[{label:"Hot Novel",value:"sort/nov-love-hot"},{label:"Completed Novel",value:"sort/nov-love-complete"},{label:"Most Popular",value:"sort/nov-love-popular"}]},genres:{type:"Picker",label:"Genre",value:"",options:[{label:"Action",value:"nov-love-genres/action"},{label:"Adventure",value:"nov-love-genres/adventure"},{label:"Anime & comics",value:"nov-love-genres/anime-&-comics"},{label:"Comedy",value:"nov-love-genres/comedy"},{label:"Drama",value:"nov-love-genres/drama"},{label:"Eastern",value:"nov-love-genres/eastern"},{label:"Fan-fiction",value:"nov-love-genres/fan-fiction"},{label:"Fanfiction",value:"nov-love-genres/fanfiction"},{label:"Fantasy",value:"nov-love-genres/fantasy"},{label:"Game",value:"nov-love-genres/game"},{label:"Games",value:"nov-love-genres/games"},{label:"Gender bender",value:"nov-love-genres/gender-bender"},{label:"General",value:"nov-love-genres/general"},{label:"Harem",value:"nov-love-genres/harem"},{label:"Historical",value:"nov-love-genres/historical"},{label:"Horror",value:"nov-love-genres/horror"},{label:"Isekai",value:"nov-love-genres/isekai"},{label:"Josei",value:"nov-love-genres/josei"},{label:"Litrpg",value:"nov-love-genres/litrpg"},{label:"Magic",value:"nov-love-genres/magic"},{label:"Magical realism",value:"nov-love-genres/magical-realism"},{label:"Martial arts",value:"nov-love-genres/martial-arts"},{label:"Mature",value:"nov-love-genres/mature"},{label:"Mecha",value:"nov-love-genres/mecha"},{label:"Modern life",value:"nov-love-genres/modern-life"},{label:"Myster",value:"nov-love-genres/myster"},{label:"Mystery",value:"nov-love-genres/mystery"},{label:"Other",value:"nov-love-genres/other"},{label:"Psychological",value:"nov-love-genres/psychological"},{label:"Reincarnation",value:"nov-love-genres/reincarnation"},{label:"Report story",value:"nov-love-genres/report-story"},{label:"Romance",value:"nov-love-genres/romance"},{label:"Romance.smut",value:"nov-love-genres/romance.smut"},{label:"School life",value:"nov-love-genres/school-life"},{label:"Sci-fi",value:"nov-love-genres/sci-fi"},{label:"Seinen",value:"nov-love-genres/seinen"},{label:"Shoujo",value:"nov-love-genres/shoujo"},{label:"Shoujo ai",value:"nov-love-genres/shoujo-ai"},{label:"Shounen",value:"nov-love-genres/shounen"},{label:"Shounen ai",value:"nov-love-genres/shounen-ai"},{label:"Slice of life",value:"nov-love-genres/slice-of-life"},{label:"Smut",value:"nov-love-genres/smut"},{label:"Sports",value:"nov-love-genres/sports"},{label:"Supernatural",value:"nov-love-genres/supernatural"},{label:"System",value:"nov-love-genres/system"},{label:"Thriller",value:"nov-love-genres/thriller"},{label:"Tragedy",value:"nov-love-genres/tragedy"},{label:"Urban",value:"nov-love-genres/urban"},{label:"Urban life",value:"nov-love-genres/urban-life"},{label:"Video games",value:"nov-love-genres/video-games"},{label:"War",value:"nov-love-genres/war"},{label:"Wuxia",value:"nov-love-genres/wuxia"},{label:"Xianxia",value:"nov-love-genres/xianxia"},{label:"Xuanhuan",value:"nov-love-genres/xuanhuan"},{label:"Yaoi",value:"nov-love-genres/yaoi"},{label:"Yuri",value:"nov-love-genres/yuri"}]}}});exports.default=l;